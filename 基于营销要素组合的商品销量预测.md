# 基于营销要素组合的商品销量预测



## 一. 项目背景

### 1. 概述

项目背景：本项目使用某公司过往营销活动相关数据，根据营销活动类型、营销活动重要性、商品重要性分级、营销资源位数量等多项营销要素，构建了可在不同营销场景下应用的商品销量预测模型。

分析流程：首先进行数据预处理，填充缺失值并将数据集划分为训练集和测试集；接下来以GradientBoostingRegressor算法建立回归模型，通过GridSearchCV获取最优参数，根据MSE指标对回归模型进行评估，结果显示预测数据与真实数据具有良好的拟合程度，表明本次构建的模型可以根据不同的营销要素组合对商品销量进行预测。

### 2. 数据属性说明

limit_infor：是否限购，1代表有，0代表没有

campaign_type：促销活动类型，分类型变量，值域为[0,6],代表7种不同类型的促销活动，例如单品活动、跨店铺活动、综合性活动、3C大品类活动等。

campaign_level：促销活动重要性，分类型变量，值域为[0,1]，0-1代表了促销活动本身的重要程度。

product_level：产品重要性分级，分类型变量，值域为[1,3]，分别代表运营部门对于商品重要性的分级。

resource_amount：促销资源位数量，整数型变量，代表每次该商品在参加促销活动时有多少个资源位入口。

email_rate：发送电子邮件中包含商品的比例，浮点型变量，值域[0,1]，值越大代表包含该商品的电子邮件越多。

price：单品价格，整数型变量，代表商品在不同阶段的实际销售价格。

discount_rate：折扣率，浮点型变量，值域[0,1]，值越大代表折扣力度越大。

hour_resouces：在促销活动中展示的小时数，整数型变量，值越大代表展示的时间越长。

campaign_fee：该单品的促销费用，整数型变量，值越大代表用于该单品的综合促销费用越高，这里面包含促销费用、广告费用、优惠券费用等综合摊派的费用。

orders：代表该单品在每次活动中形成的订单量。

### 3. 工具包的加载和数据读取

```
import numpy as np 
import pandas as pd  
import matplotlib.pyplot as plt
# 集成方法回归库
from sklearn.ensemble import GradientBoostingRegressor
# 导入交叉检验库
from sklearn.model_selection import GridSearchCV  
from sklearn.metrics import mean_squared_error as mse
```

```
raw_data = pd.read_table('D:\Code\Commodity Sales Forecast Based On The Combination Of Marketing Elements\Data\products_sales.txt', delimiter=',')
```



## 二. .数据探索

### 1. 描述性统计

```
# 数据概览
#打印原始数据后2条
print('{:*^60}'.format('Data overview:'),'\n',raw_data.tail(2))
# 数据类型
print('{:*^60}'.format('Data dtypes:'),'\n',raw_data.dtypes)
```

```
***********************Data overview:*********************** 
      limit_infor  campaign_type  campaign_level  product_level  \
729            0              6               0              1   
730            0              6               0              1   

     resource_amount  email_rate  price  discount_rate  hour_resouces  \
729                8         0.8  150.0           0.87            987   
730                9         0.8  149.0           0.84           1448   

     campaign_fee  orders  
729          2298    3285  
730          3392    4840  
************************Data dtypes:************************ 
 limit_infor          int64
campaign_type        int64
campaign_level       int64
product_level        int64
resource_amount      int64
email_rate         float64
price              float64
discount_rate      float64
hour_resouces        int64
campaign_fee         int64
orders               int64
dtype: object
```

### 2. 缺失值统计

```
# 缺失值统计
# 查看每一列是否具有缺失值
na_cols = raw_data.isnull().any(axis=0)  
print('{:*^60}'.format('NA Cols:'))
# 查看具有缺失值的列
print(na_cols[na_cols]==True)
# 查看具有缺失值的行总记录数
print('Total NA lines is: {0}'.format(raw_data.isnull().any(axis=1).sum())) 
```

```
**************************NA Cols:**************************
price    True
dtype: bool
Total NA lines is: 2
```



## 三. 数据预处理

### 1. 数据清洗

#### （1）缺失值处理

```
# 缺失值处理
# 缺失值替换为均值
sales_data = raw_data.fillna(raw_data['price'].mean())  
sales_data.head()
```

|      | limit_infor | campaign_type | campaign_level | product_level | resource_amount | email_rate | price | discount_rate | hour_resouces | campaign_fee | orders |
| ---- | ----------- | ------------- | -------------- | ------------- | --------------- | ---------- | ----- | ------------- | ------------- | ------------ | ------ |
| 0    | 0           | 6             | 0              | 1             | 1               | 0.08       | 140.0 | 0.83          | 93            | 888          | 1981   |
| 1    | 0           | 0             | 0              | 1             | 1               | 0.10       | 144.0 | 0.75          | 150           | 836          | 986    |
| 2    | 0           | 1             | 1              | 1             | 1               | 0.12       | 149.0 | 0.84          | 86            | 1330         | 1416   |
| 3    | 0           | 3             | 1              | 2             | 1               | 0.12       | 141.0 | 0.82          | 95            | 2273         | 2368   |
| 4    | 0           | 0             | 0              | 1             | 1               | 0.10       | 146.0 | 0.59          | 73            | 1456         | 1529   |

### 2. 分割数据集

```
# 分割数据集X和y
num = int(0.7*sales_data.shape[0])
X,y = sales_data.iloc[:, :-1],sales_data.iloc[:, -1]
X_train,X_test = X.iloc[:num,:],X.iloc[num:,:]
y_train,y_test = y.iloc[:num],y.iloc[num:]
```



## 四. 构建模型

### 1. 模型训练

```
# 模型最优化参数训练及检验
# 建立GradientBoostingRegressor回归对象
model_gbr = GradientBoostingRegressor() 
# 定义要优化的参数信息
parameters = {'loss': ['ls', 'lad', 'huber', 'quantile'],
              'n_estimators': [10, 50, 100],
              'learning_rate': [0.05, 0.1, 0.15],
              'max_depth': [2, 3, 4],
              'min_samples_split': [2, 3, 5],
              'min_samples_leaf': [1, 2, 4]} 
# 建立交叉检验模型对象
model_gs = GridSearchCV(estimator=model_gbr,
                        param_grid=parameters, cv=3, n_jobs=-1)
# 训练交叉检验模型
model_gs.fit(X_train, y_train)
# 获得交叉检验模型得出的最优得分
print('Best score is:', model_gs.best_score_)
# 获得交叉检验模型得出的最优参数
print('Best parameter is:', model_gs.best_params_)  
```

```
Best score is: 0.9549742015688556
Best parameter is: {'learning_rate': 0.15, 'loss': 'huber', 'max_depth': 2, 'min_samples_leaf': 1, 'min_samples_split': 2, 'n_estimators': 100}
```

```
# 获取最佳训练模型
# 获得交叉检验模型得出的最优模型对象
model_best = model_gs.best_estimator_ 
```

### 2. 模型评估

#### （1）交叉检验结果

```
# 模型交叉检验结果
print(model_gs.cv_results_.keys())
```

```
dict_keys(['mean_fit_time', 'std_fit_time', 'mean_score_time', 'std_score_time', 'param_learning_rate', 'param_loss', 'param_max_depth', 'param_min_samples_leaf', 'param_min_samples_split', 'param_n_estimators', 'params', 'split0_test_score', 'split1_test_score', 'split2_test_score', 'mean_test_score', 'std_test_score', 'rank_test_score', 'split0_train_score', 'split1_train_score', 'split2_train_score', 'mean_train_score', 'std_train_score'])
```

```
model_gs.cv_results_.get('mean_test_score')
```

```
array([-3.05816147e-01,  8.06504643e-01,  9.14213858e-01, -3.05816147e-01,
        8.06504643e-01,  9.14612601e-01, -3.05816147e-01,  8.06504643e-01,
        9.15112525e-01, -3.05816147e-01,  8.06504643e-01,  9.18783300e-01,
       -3.05816147e-01,  8.06504643e-01,  9.18783300e-01, -3.05816147e-01,
        8.06504643e-01,  9.18825852e-01, -3.05816147e-01,  8.06504643e-01,
        9.19481419e-01, -3.05816147e-01,  8.06504643e-01,  9.19481419e-01,
       -3.05816147e-01,  8.06504643e-01,  9.19481419e-01, -1.61049733e-01,
        8.69155138e-01,  9.12605177e-01, -1.61049733e-01,  8.69147266e-01,
        9.12677963e-01, -1.61049733e-01,  8.69103557e-01,  9.12752385e-01,
       -1.61049733e-01,  8.68683711e-01,  9.09531843e-01, -1.61049733e-01,
        8.68650231e-01,  9.09560650e-01, -1.61049733e-01,  8.68701799e-01,
        9.05991123e-01, -1.59828437e-01,  8.76270168e-01,  9.05786759e-01,
       -1.59828437e-01,  8.76270168e-01,  9.05748593e-01, -1.59828437e-01,
        8.76230766e-01,  9.05748593e-01, -1.29620851e-01,  8.66018772e-01,
        9.01070490e-01, -1.28456567e-01,  8.70182904e-01,  9.05913364e-01,
       -1.28835621e-01,  8.68898279e-01,  9.05075939e-01, -1.07736092e-01,
        8.69875954e-01,  8.90894719e-01, -1.08571347e-01,  8.69856156e-01,
        8.91428492e-01, -1.08162149e-01,  8.69651704e-01,  8.95194670e-01,
       -9.81153544e-02,  8.79353564e-01,  9.00000735e-01, -9.81153544e-02,
        8.79362690e-01,  9.00004564e-01, -9.81039849e-02,  8.79317382e-01,
        9.00055234e-01, -6.49688637e-01,  6.01277137e-01,  8.29743674e-01,
       -6.49688637e-01,  6.01289607e-01,  8.34196441e-01, -6.33816653e-01,
        6.01289633e-01,  8.32030978e-01, -6.33637434e-01,  5.99128283e-01,
        8.34520095e-01, -6.33637434e-01,  5.98111796e-01,  8.34069297e-01,
       -6.33637434e-01,  5.98365489e-01,  8.37850411e-01, -6.46322659e-01,
        5.72992859e-01,  8.42652911e-01, -6.46505767e-01,  5.75108517e-01,
        8.47649932e-01, -6.46322659e-01,  6.00621237e-01,  8.45537728e-01,
       -4.87235467e-01,  6.49573852e-01,  8.94757856e-01, -4.84883167e-01,
        6.70889336e-01,  8.93113714e-01, -4.85100020e-01,  6.45782149e-01,
        8.93388256e-01, -4.87452642e-01,  6.66641496e-01,  8.96702882e-01,
       -4.84771403e-01,  6.57334161e-01,  8.87907020e-01, -4.87510824e-01,
        6.67101885e-01,  8.83496241e-01, -4.75611892e-01,  6.93211219e-01,
        8.89106381e-01, -4.89319748e-01,  6.85585832e-01,  9.01124033e-01,
       -4.84998316e-01,  6.94296571e-01,  8.76707326e-01, -4.68061159e-01,
        6.92629643e-01,  8.70712363e-01, -4.79155908e-01,  7.16138562e-01,
        8.87548739e-01, -4.96591065e-01,  6.87242508e-01,  8.96965563e-01,
       -4.79831660e-01,  7.04060123e-01,  8.87404672e-01, -4.76157781e-01,
        7.17439107e-01,  8.88531367e-01, -4.77513271e-01,  7.07787137e-01,
        8.81929847e-01, -4.58464672e-01,  7.27857199e-01,  9.07158646e-01,
       -4.45700246e-01,  7.16187345e-01,  9.06238373e-01, -4.31362113e-01,
        7.26502943e-01,  9.02619687e-01, -2.97099327e-01,  7.53044667e-01,
        9.08086372e-01, -2.97099327e-01,  7.53044667e-01,  9.07998772e-01,
       -2.97099327e-01,  7.53125709e-01,  9.08086372e-01, -2.97099327e-01,
        7.53125709e-01,  9.06912541e-01, -2.97099327e-01,  7.53044667e-01,
        9.06866590e-01, -2.97099327e-01,  7.53044667e-01,  9.06912541e-01,
       -2.97099327e-01,  7.53125709e-01,  9.06954591e-01, -2.97099327e-01,
        7.53044667e-01,  9.06942747e-01, -2.97099327e-01,  7.53125709e-01,
        9.06954591e-01, -1.62523607e-01,  8.48103608e-01,  9.32424343e-01,
       -1.62523607e-01,  8.48103608e-01,  9.32100865e-01, -1.62523607e-01,
        8.48149873e-01,  9.32626525e-01, -1.62523607e-01,  8.48711317e-01,
        9.34569678e-01, -1.62523607e-01,  8.48755829e-01,  9.32948249e-01,
       -1.62523607e-01,  8.48714023e-01,  9.34134401e-01, -1.62490930e-01,
        8.47327043e-01,  9.33911076e-01, -1.62490930e-01,  8.47327043e-01,
        9.34344866e-01, -1.62490930e-01,  8.47372557e-01,  9.34590693e-01,
       -6.65103338e-02,  8.62092300e-01,  9.21921708e-01, -6.62380758e-02,
        8.63096106e-01,  9.18514376e-01, -6.65079020e-02,  8.64787470e-01,
        9.21000417e-01, -6.36638958e-02,  8.66949467e-01,  9.31663273e-01,
       -6.36385139e-02,  8.67071153e-01,  9.31756628e-01, -6.36156712e-02,
        8.67348126e-01,  9.31089478e-01, -6.39377231e-02,  8.67384562e-01,
        9.31403149e-01, -6.41705595e-02,  8.66599045e-01,  9.30474778e-01,
       -6.37038922e-02,  8.66619222e-01,  9.30771679e-01, -4.50887880e+00,
       -1.92824753e+00, -6.07599364e-01, -4.47981052e+00, -1.93088661e+00,
       -6.62504416e-01, -4.50887880e+00, -1.92829799e+00, -6.31402516e-01,
       -4.52392826e+00, -1.77619417e+00, -5.62100299e-01, -4.49492975e+00,
       -1.95126140e+00, -6.66066718e-01, -4.52392826e+00, -1.80052275e+00,
       -5.89418803e-01, -4.50938767e+00, -1.63393978e+00, -6.12778903e-01,
       -4.47441054e+00, -1.73997420e+00, -5.86729837e-01, -4.50347881e+00,
       -1.59623427e+00, -5.50383175e-01, -4.35685502e+00, -1.43960407e+00,
       -4.48094221e-01, -4.36015526e+00, -1.51160911e+00, -4.92121440e-01,
       -4.32732784e+00, -1.51922435e+00, -3.82765683e-01, -4.37971105e+00,
       -1.39541985e+00, -3.51453352e-01, -4.34313779e+00, -1.46511540e+00,
       -4.25783660e-01, -4.37794282e+00, -1.45076182e+00, -3.53822789e-01,
       -4.33072364e+00, -1.46470172e+00, -2.77183743e-01, -4.26323609e+00,
       -1.45749438e+00, -2.63232915e-01, -4.27186823e+00, -1.46203361e+00,
       -2.04837307e-01, -4.30455470e+00, -1.38222132e+00, -2.58535605e-01,
       -4.35932174e+00, -1.34538182e+00, -1.99441764e-01, -4.36257791e+00,
       -1.34066020e+00, -2.21105838e-01, -4.29147690e+00, -1.25399754e+00,
       -2.80965677e-01, -4.31189244e+00, -1.35564716e+00, -2.96637035e-01,
       -4.34036317e+00, -1.30358472e+00, -2.78024347e-01, -4.31617925e+00,
       -1.30374491e+00, -2.25962017e-01, -4.31650303e+00, -1.28724685e+00,
       -2.55490413e-01, -4.33892523e+00, -1.35545801e+00, -1.59214878e-01,
        2.66098418e-01,  9.20107263e-01,  9.14360345e-01,  2.66098418e-01,
        9.19129361e-01,  9.15393706e-01,  2.66098418e-01,  9.19136581e-01,
        9.16462175e-01,  2.66098418e-01,  9.20768074e-01,  9.12545387e-01,
        2.66098418e-01,  9.20768074e-01,  9.12734007e-01,  2.66098418e-01,
        9.20768074e-01,  9.12558762e-01,  2.66098418e-01,  9.17352165e-01,
        9.04884215e-01,  2.66098418e-01,  9.17352165e-01,  9.04884215e-01,
        2.66098418e-01,  9.17352165e-01,  9.04884215e-01,  4.59996544e-01,
        9.16245925e-01,  9.07583318e-01,  4.59862890e-01,  9.16868065e-01,
        9.08332956e-01,  4.59996544e-01,  9.16999602e-01,  9.13260591e-01,
        4.59996544e-01,  9.02745176e-01,  8.76966882e-01,  4.59996544e-01,
        9.02265382e-01,  8.77006422e-01,  4.59996544e-01,  9.02254411e-01,
        8.82654482e-01,  4.68320143e-01,  9.08514708e-01,  8.84988095e-01,
        4.68320143e-01,  9.08457854e-01,  8.85005164e-01,  4.68186489e-01,
        9.08466900e-01,  8.84989297e-01,  5.05230818e-01,  9.01677087e-01,
        8.98739289e-01,  5.05389177e-01,  8.98908904e-01,  8.96959850e-01,
        5.06735674e-01,  9.03336822e-01,  9.00719824e-01,  5.12978387e-01,
        8.97811976e-01,  8.85604130e-01,  5.12946620e-01,  8.97889099e-01,
        8.86314732e-01,  5.12914875e-01,  8.95861959e-01,  8.82049343e-01,
        5.36612590e-01,  9.02345804e-01,  8.94240529e-01,  5.36689619e-01,
        9.02347694e-01,  8.94222099e-01,  5.36448356e-01,  9.02322493e-01,
        8.94236118e-01, -1.14248160e-01,  8.34967913e-01,  9.35303503e-01,
       -1.14248160e-01,  8.32086954e-01,  9.36650565e-01, -1.14248160e-01,
        8.31876462e-01,  9.37570251e-01, -1.14229615e-01,  8.32089941e-01,
        9.30717198e-01, -1.14229615e-01,  8.25984513e-01,  9.39205672e-01,
       -1.14229615e-01,  8.32180944e-01,  9.36386095e-01, -8.86363566e-02,
        8.37253246e-01,  9.43562969e-01, -8.86363566e-02,  8.37493711e-01,
        9.38522508e-01, -8.84679174e-02,  8.37427352e-01,  9.38920156e-01,
        5.59331521e-02,  8.87696812e-01,  9.32785077e-01,  5.64140396e-02,
        8.84342554e-01,  9.20312995e-01,  5.55452909e-02,  8.87405587e-01,
        9.26418277e-01,  7.27632813e-02,  8.81090033e-01,  9.32276590e-01,
        6.55154957e-02,  8.95340246e-01,  9.27230127e-01,  7.20896202e-02,
        8.97294145e-01,  9.24625688e-01,  1.40730524e-01,  8.69184060e-01,
        9.27576913e-01,  7.90011924e-02,  8.98631147e-01,  9.30600726e-01,
        7.78214704e-02,  8.79832444e-01,  9.28561284e-01,  1.06991059e-01,
        8.78368332e-01,  8.92515283e-01,  7.07786786e-02,  8.91159796e-01,
        8.93939766e-01,  1.10008109e-01,  8.80905743e-01,  9.17514393e-01,
        1.48429559e-01,  8.76990029e-01,  9.15526450e-01,  1.21233988e-01,
        8.93675947e-01,  9.22308378e-01,  1.71352240e-01,  8.94269792e-01,
        8.87293673e-01,  1.29649638e-01,  9.01778102e-01,  9.28939002e-01,
        1.79471567e-01,  8.93953598e-01,  9.26367915e-01,  1.52261121e-01,
        8.99707014e-01,  9.28915695e-01,  2.35780425e-01,  9.11763765e-01,
        9.49882489e-01,  2.35780425e-01,  9.12213064e-01,  9.49737577e-01,
        2.35780425e-01,  9.12213064e-01,  9.51386622e-01,  2.35780425e-01,
        9.11873678e-01,  9.49726139e-01,  2.35780425e-01,  9.11873678e-01,
        9.50316064e-01,  2.35780425e-01,  9.11873678e-01,  9.49824240e-01,
        2.35780425e-01,  9.12111139e-01,  9.46423172e-01,  2.35780425e-01,
        9.12111139e-01,  9.46423172e-01,  2.35780425e-01,  9.12111139e-01,
        9.46423172e-01,  4.13431226e-01,  9.30997790e-01,  9.39253309e-01,
        4.13374683e-01,  9.30925720e-01,  9.38455823e-01,  4.13374683e-01,
        9.30751718e-01,  9.41138446e-01,  4.13399708e-01,  9.35198037e-01,
        9.45587918e-01,  4.13399708e-01,  9.34543950e-01,  9.45267650e-01,
        4.13399708e-01,  9.34454582e-01,  9.37259024e-01,  4.13858936e-01,
        9.34690000e-01,  9.42414281e-01,  4.13858936e-01,  9.34622335e-01,
        9.42046073e-01,  4.13858936e-01,  9.34423953e-01,  9.42235654e-01,
        4.98872750e-01,  9.23558720e-01,  9.22080753e-01,  5.04788094e-01,
        9.29092883e-01,  9.22943600e-01,  5.06278475e-01,  9.25461082e-01,
        9.34057895e-01,  5.13828920e-01,  9.24479147e-01,  9.03458990e-01,
        5.13191425e-01,  9.25554857e-01,  9.28386394e-01,  5.14138917e-01,
        9.25839668e-01,  9.15880111e-01,  5.04122422e-01,  9.30465858e-01,
        9.37101438e-01,  5.04681588e-01,  9.30400342e-01,  9.36918270e-01,
        5.04840999e-01,  9.30090662e-01,  9.37216209e-01, -3.63129193e+00,
       -7.04743300e-01,  2.40311612e-01, -3.70472796e+00, -7.28775608e-01,
        2.50660614e-01, -3.63074977e+00, -6.17431215e-01,  2.25606821e-01,
       -3.38063400e+00, -6.31770361e-01,  3.36362113e-01, -3.38092458e+00,
       -5.08053547e-01,  2.37379360e-01, -3.38065823e+00, -4.81611077e-01,
        3.29675285e-01, -3.38064163e+00, -5.95003552e-01,  1.39353888e-01,
       -3.38071568e+00, -6.00317174e-01,  2.04917379e-01, -3.38064163e+00,
       -5.70718444e-01,  1.51057004e-01, -3.31541232e+00, -4.32936726e-01,
        2.25623880e-01, -3.31489253e+00, -3.80645215e-01,  2.03640648e-01,
       -3.31506779e+00, -4.34196478e-01,  1.27526038e-01, -3.22684166e+00,
       -4.17649174e-01,  1.93177070e-01, -3.36666080e+00, -4.32254878e-01,
        2.45095249e-01, -3.21384135e+00, -3.97066755e-01,  1.42884040e-01,
       -3.32659850e+00, -3.30779727e-01,  4.31080448e-01, -3.33219875e+00,
       -2.84818557e-01,  4.09270592e-01, -3.31671426e+00, -3.28962348e-01,
        3.68020997e-01, -3.32518194e+00, -2.89811712e-01,  4.30978575e-01,
       -3.31354952e+00, -1.98705446e-01,  4.46009612e-01, -3.25485135e+00,
       -3.30844623e-01,  4.11498299e-01, -3.30569055e+00, -2.65905719e-01,
        4.79554072e-01, -3.29892939e+00, -2.10009012e-01,  4.92535966e-01,
       -3.33936846e+00, -3.28640360e-01,  4.33490534e-01, -3.32238682e+00,
       -2.26774151e-01,  3.97206077e-01, -3.33371077e+00, -2.10037750e-01,
        3.53781689e-01, -3.32141490e+00, -2.74451963e-01,  3.79193889e-01,
        5.76679693e-01,  9.18309397e-01,  9.05392441e-01,  5.76679693e-01,
        9.17544815e-01,  9.07145766e-01,  5.76679693e-01,  9.19364903e-01,
        9.06464406e-01,  5.76679693e-01,  9.22794234e-01,  8.99725405e-01,
        5.76679693e-01,  9.23132775e-01,  9.00358100e-01,  5.76679693e-01,
        9.19868587e-01,  8.99238509e-01,  5.76679693e-01,  9.14560896e-01,
        8.94239045e-01,  5.76679693e-01,  9.14560896e-01,  8.94286202e-01,
        5.76679693e-01,  9.14560896e-01,  8.94358314e-01,  7.37266462e-01,
        9.06633502e-01,  9.03424290e-01,  7.37266462e-01,  9.10248033e-01,
        9.07000649e-01,  7.37266462e-01,  9.10429479e-01,  9.05279216e-01,
        7.36374709e-01,  8.87854277e-01,  8.74247278e-01,  7.36374709e-01,
        8.86811723e-01,  8.72907854e-01,  7.36374709e-01,  8.93980760e-01,
        8.73796132e-01,  7.33582571e-01,  9.00166258e-01,  8.75170097e-01,
        7.33582571e-01,  9.00619163e-01,  8.74581098e-01,  7.33582571e-01,
        9.00619163e-01,  8.74650940e-01,  7.36129405e-01,  9.03197420e-01,
        8.98969125e-01,  7.36038678e-01,  9.05409785e-01,  9.02202173e-01,
        7.36450991e-01,  9.00747871e-01,  8.99202348e-01,  7.46588227e-01,
        8.90825441e-01,  8.88593770e-01,  7.47230262e-01,  8.88149284e-01,
        8.90276027e-01,  7.46256377e-01,  8.88115958e-01,  8.85575519e-01,
        7.64702832e-01,  8.92308130e-01,  8.88237370e-01,  7.64702832e-01,
        8.92497373e-01,  8.88279069e-01,  7.64702832e-01,  8.92378894e-01,
        8.88242127e-01,  2.54596558e-01,  9.12234228e-01,  9.46322338e-01,
        2.54596558e-01,  9.13178704e-01,  9.45119971e-01,  2.54596558e-01,
        9.11192697e-01,  9.45322790e-01,  2.54323403e-01,  8.98839264e-01,
        9.46374347e-01,  2.54323403e-01,  9.01283620e-01,  9.45406733e-01,
        2.54323403e-01,  9.03221197e-01,  9.43654498e-01,  2.83277651e-01,
        9.14146723e-01,  9.46154087e-01,  2.83277651e-01,  9.07603387e-01,
        9.45941087e-01,  2.82562060e-01,  9.12932222e-01,  9.46665640e-01,
        4.34777186e-01,  9.15007062e-01,  9.21175482e-01,  4.33954950e-01,
        9.20207362e-01,  9.19287374e-01,  4.30589247e-01,  9.17668218e-01,
        9.30934279e-01,  4.34750124e-01,  9.06418690e-01,  9.34096048e-01,
        4.34678124e-01,  9.10568120e-01,  9.18120929e-01,  4.29754464e-01,
        9.16939529e-01,  9.31116569e-01,  4.53239785e-01,  9.21640261e-01,
        9.38507957e-01,  4.07301233e-01,  9.29545195e-01,  9.41789166e-01,
        4.85748216e-01,  9.31831038e-01,  9.35784633e-01,  3.90463343e-01,
        9.12323668e-01,  9.05367528e-01,  4.00724428e-01,  9.09987321e-01,
        9.27525853e-01,  4.09399889e-01,  8.92293327e-01,  9.14893196e-01,
        4.65475121e-01,  9.08094169e-01,  9.13299078e-01,  4.43645718e-01,
        9.21094280e-01,  9.32597156e-01,  3.99429901e-01,  9.15264183e-01,
        8.98850129e-01,  4.99456347e-01,  9.24724531e-01,  9.24226166e-01,
        4.88933443e-01,  9.23587620e-01,  9.34800698e-01,  4.85521735e-01,
        9.17857488e-01,  9.22980312e-01,  5.16800096e-01,  9.48424953e-01,
        9.54974202e-01,  5.16800096e-01,  9.48350066e-01,  9.54458686e-01,
        5.16800096e-01,  9.49007351e-01,  9.54410446e-01,  5.16800096e-01,
        9.48608743e-01,  9.54562447e-01,  5.16800096e-01,  9.48699500e-01,
        9.53625924e-01,  5.16800096e-01,  9.48283324e-01,  9.54700356e-01,
        5.16800096e-01,  9.45840318e-01,  9.50766478e-01,  5.16800096e-01,
        9.45822694e-01,  9.50758869e-01,  5.16800096e-01,  9.45822694e-01,
        9.50770546e-01,  6.63914023e-01,  9.37069196e-01,  9.34531659e-01,
        6.63914023e-01,  9.37403149e-01,  9.16924886e-01,  6.63914023e-01,
        9.37997566e-01,  9.40232031e-01,  6.64610538e-01,  9.39579179e-01,
        9.45183634e-01,  6.64610538e-01,  9.41065888e-01,  9.44622405e-01,
        6.64610538e-01,  9.42811368e-01,  9.42404703e-01,  6.73131818e-01,
        9.39815200e-01,  9.42469154e-01,  6.73131818e-01,  9.39281344e-01,
        9.42607355e-01,  6.73131818e-01,  9.39915491e-01,  9.42933603e-01,
        7.15861903e-01,  9.25729998e-01,  9.17696167e-01,  7.21571065e-01,
        9.21903815e-01,  9.21284459e-01,  7.23920528e-01,  9.20604434e-01,
        9.13713827e-01,  7.39346914e-01,  9.41134840e-01,  9.31689551e-01,
        7.38646344e-01,  9.33392336e-01,  8.97701690e-01,  7.38678224e-01,
        9.40599835e-01,  9.36341198e-01,  7.36410331e-01,  9.35222085e-01,
        9.36388466e-01,  7.36610234e-01,  9.35467438e-01,  9.36508634e-01,
        7.36610234e-01,  9.35895164e-01,  9.37172053e-01, -3.11104350e+00,
        9.41691663e-02,  4.69036539e-01, -3.11104350e+00,  3.76598204e-04,
        4.69611159e-01, -3.11104350e+00, -2.74066897e-05,  4.84313042e-01,
       -3.05420033e+00,  7.63104029e-02,  4.49777978e-01, -3.05419818e+00,
        8.61873687e-02,  4.84307683e-01, -3.07478213e+00,  7.29308824e-02,
        3.98373957e-01, -2.98330488e+00, -2.12098024e-02,  4.16103862e-01,
       -2.98330488e+00, -2.61071492e-02,  3.44959394e-01, -2.98202330e+00,
       -5.72370076e-02,  4.12092351e-01, -2.43084056e+00,  9.50308733e-02,
        5.48498954e-01, -2.43107784e+00,  5.92531583e-02,  5.58100975e-01,
       -2.43006006e+00,  1.49663187e-01,  4.32569113e-01, -2.38292550e+00,
        6.26042503e-02,  4.55598908e-01, -2.38260434e+00,  1.21753749e-01,
        5.39071258e-01, -2.38459643e+00,  2.98842747e-02,  3.73400670e-01,
       -2.49516786e+00,  2.97083422e-01,  4.64411246e-01, -2.44980775e+00,
        2.25865936e-01,  5.67095524e-01, -2.17909490e+00,  2.18768056e-01,
        5.77160993e-01, -2.31109715e+00,  1.43519241e-01,  5.43121413e-01,
       -2.31192200e+00,  2.49048712e-01,  4.99503858e-01, -2.30672949e+00,
        2.15561398e-01,  6.10169944e-01, -2.39720920e+00,  2.54705715e-01,
        5.50261824e-01, -2.37816416e+00,  2.14983352e-01,  7.08924978e-01,
       -2.42739573e+00,  1.71245852e-01,  5.89174961e-01, -2.54956057e+00,
        1.89110758e-01,  5.50665460e-01, -2.41729003e+00,  1.56465605e-01,
        4.85039429e-01, -2.75981782e+00,  1.38695952e-01,  6.04476631e-01])
```

#### （2）回归指标评估

```
# 回归指标评估
pre_test = model_best.predict(X_test)
mse_score = mse(pre_test,y_test)
```

#### （3）模型拟合程度

```
# 模型拟合程度
# 应用ggplot自带样式库
plt.style.use("ggplot")
# 建立画布对象
plt.figure(figsize=(10,7))
# 画出原始变量的曲线
plt.plot(np.arange(X_test.shape[0]), y_test, linestyle='-', color='k', label='true y') 
 # 画出预测变量曲线
plt.plot(np.arange(X_test.shape[0]), pre_test, linestyle=':', color='m',
         label='predicted y') 
plt.title('best model with mse of {}'.format(int(mse_score)))
# 设置图例位置
plt.legend(loc=0)
# 保存
plt.savefig('D:\Code\Commodity Sales Forecast Based On The Combination Of Marketing Elements\Result\拟合图.png')
```

![](D:\Code\Commodity Sales Forecast Based On The Combination Of Marketing Elements\Result\拟合图.png)

#### （4）根据新的营销要素进行预测

```
# 要预测的新数据记录
New_X = np.array([[1, 1, 0, 1, 15, 0.5, 177, 0.66, 101, 798]])  
print('{:*^60}'.format('Predicted orders:'))
# 打印输出预测值
print(model_best.predict(New_X).round(0))  
```

```
*********************Predicted orders:**********************
[833.]
```

